<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /signature_generator/

  # Redirect to api.php if URL starts with /signature_generator/api/
  RewriteCond %{REQUEST_URI} !(\.png|\.jpg|\.webp|\.gif|\.jpeg|\.zip|\.css|\.svg|\.js|\.pdf|\.mo|\.po)$ [NC]
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_URI} ^/signature_generator/api/ [NC]
  RewriteCond %{REQUEST_URI} !^/signature_generator/locale/ [NC]
  RewriteRule (.*) api.php [QSA,L]

  # Redirect to routes.php for all other URLs
  RewriteCond %{REQUEST_URI} !(\.png|\.jpg|\.webp|\.gif|\.jpeg|\.zip|\.css|\.svg|\.js|\.pdf|\.mo|\.po)$ [NC]
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_URI} !^/signature_generator/assets/ [NC]
  RewriteCond %{REQUEST_URI} !^/signature_generator/api/ [NC]
  RewriteCond %{REQUEST_URI} !^/signature_generator/locale/ [NC]
  RewriteRule (.*) routes.php [QSA,L]
</IfModule>

<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE text/xml
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE image/x-icon
  AddOutputFilterByType DEFLATE image/svg+xml
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE application/xhtml+xml 
  AddOutputFilterByType DEFLATE application/x-font 
  AddOutputFilterByType DEFLATE application/x-font-truetype 
  AddOutputFilterByType DEFLATE application/x-font-ttf 
  AddOutputFilterByType DEFLATE application/x-font-otf 
  AddOutputFilterByType DEFLATE application/x-font-opentype 
  AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
  AddOutputFilterByType DEFLATE font/ttf 
  AddOutputFilterByType DEFLATE font/otf 
  AddOutputFilterByType DEFLATE font/opentype
  # For Older Browsers Which Can't Handle Compression
  BrowserMatch ^Mozilla/4 gzip-only-text/html 
  BrowserMatch ^Mozilla/4\.0[678] no-gzip
  BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
</IfModule>

<FilesMatch ".(woff|flv|gif|jpg|jpeg|png|ico|swf|js|css|pdf)$">
  Header set Cache-Control "max-age=25920000"
</FilesMatch>
<IfModule mod_expires.c>
  ExpiresActive On
  
  ExpiresDefault "access plus 6 month"
  # Set cache expiration time for images
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType image/vnd.microsoft.icon "access plus 1 year"
  ExpiresByType image/x-icon "access plus 1 year"
  
  # Set cache expiration time for web fonts
  ExpiresByType application/vnd.ms-fontobject "access plus 1 year"
  ExpiresByType application/x-font-ttf "access plus 1 year"
  ExpiresByType font/opentype "access plus 1 year"
  
  # Set cache expiration time for other static files
  ExpiresByType text/css "access plus 1 year"
  ExpiresByType text/javascript "access plus 1 year"
  ExpiresByType application/javascript "access plus 1 year"
  ExpiresByType application/x-javascript "access plus 1 year"
  ExpiresByType application/pdf "access plus 1 year"
</IfModule>

# Enable Gzip compression
<IfModule mod_deflate.c>
    SetOutputFilter DEFLATE
    <IfModule mod_setenvif.c>
        # Netscape 4.x has some problems...
        BrowserMatch ^Mozilla/4 gzip-only-text/html

        # Netscape 4.06-4.08 have some more problems
        BrowserMatch ^Mozilla/4\.0[678] no-gzip

        # MSIE masquerades as Netscape, but it is fine
        # BrowserMatch \bMSIE !no-gzip !gzip-only-text/html

        # NOTE: Due to a bug in mod_setenvif up to Apache 2.0.48
        # the above regex won't work. You can use the following
        # workaround to get the desired effect:
        BrowserMatch \bMSI[E] !no-gzip !gzip-only-text/html

        # Don't compress images and other uncompressible content
        SetEnvIfNoCase Request_URI \
        \.(?:gif|jpe?g|png|rar|zip|tar|pdf|swf|exe)$ no-gzip dont-vary
    </IfModule>
    <IfModule mod_headers.c>
        # Make sure proxies don't deliver the wrong content
        Header append Vary User-Agent env=!dont-vary
    </IfModule>
</IfModule>

# <IfModule mod_headers.c>
# 	<IfModule mod_rewrite.c>
# 		RewriteEngine On
# 		RewriteCond %{HTTP:Accept-Encoding} (^|\W)gzip(\W|$)
# 		RewriteCond %{REQUEST_FILENAME} \.(css|js)$
# 		RewriteCond %{REQUEST_FILENAME}.gz -f
# 		RewriteRule ^(.*)\.(css|js)$ $1\.$2\.gz [QSA]
# 		RewriteRule \.css\.gz$ - [T=text/css,E=no-gzip:1,E=no-brotli:1]
# 		RewriteRule \.js\.gz$ - [T=application/javascript,E=no-gzip:1,E=no-brotli:1]
# 	</IfModule>
# 	<FilesMatch \.(js|css)\.gz$>
# 		Header set Content-Encoding gzip
# 		Header merge Vary Accept-Encoding
# 	</FilesMatch>
# </IfModule>